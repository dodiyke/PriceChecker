<!DOCTYPE html>
<html>
<head>
    <title>Barcode Scanner</title>
</head>
<body>
    <h1>Barcode Scanner</h1>

    <!-- Create a container for the video feed -->
    <div id="barcode-scanner">
        <video id="camera-feed"></video>
    </div>

    <!-- Button to start scanning -->
    <button id="scan-button">Scan Barcode</button>

    <!-- Display item information -->
    <div id="item-info" style="display: none;">
        <h2>Item Information</h2>
        <p><strong>Name:</strong> <span id="itemName"></span></p>
        <p><strong>Description:</strong> <span id="itemDescription"></span></p>
        <p><strong>Price:</strong> <span id="itemPrice"></span></p>
        <img src="" id="itemPhoto" alt="Item Photo">
    </div>

    <!-- Include QuaggaJS library for barcode scanning -->
    <script src="https://cdn.rawgit.com/serratus/quaggaJS/0.12.1/dist/quagga.min.js"></script>

    <!-- Include the Google Sheets API client library -->
    <script src="https://apis.google.com/js/api.js"></script>

    <!-- Your custom JavaScript -->
    <script>
        // Initialize QuaggaJS
        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector("#camera-feed"),
                constraints: {
                    width: 640,
                    height: 480,
                },
            },
            decoder: {
                readers: ["ean_reader"],
            },
        });

        Quagga.onDetected((result) => {
            const barcode = result.codeResult.code;
            fetchItemInformation(barcode);
        });

        // Start scanning when the button is clicked
        document.getElementById("scan-button").addEventListener("click", function() {
            Quagga.start();
        });

        // Load the Google Sheets API
        gapi.load("client", initGoogleSheetsAPI);

        function initGoogleSheetsAPI() {
            gapi.client.init({
                apiKey: "AIzaSyDaPgYapqR8CZs1CBas4SDF3MxQVAOKeAU",
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(() => {
                // API is ready
            });
        }

        function fetchItemInformation(barcode) {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: "1aWKsnNu7FOvDifNXtd5dmCxQ4vmBhZSthpIF9X9lLw4",
                range: "Sheet2!A:E", // Adjust to your specific tab and range
            }).then((response) => {
                const values = response.result.values;
                if (values) {
                    const item = values.find((row) => row[0] === barcode);
                    if (item) {
                        const [barcode, name, description, photoUrl, price] = item;
                        document.getElementById("itemName").textContent = name;
                        document.getElementById("itemDescription").textContent = description;
                        document.getElementById("itemPrice").textContent = price;
                        document.getElementById("itemPhoto").src = photoUrl;
                        document.getElementById("item-info").style.display = "block";
                        // Stop scanning after a successful match
                        Quagga.stop();
                    } else {
                        alert("Item not found.");
                    }
                } else {
                    alert("No data available in the Google Sheet.");
                }
            });
        }
    </script>
</body>
</html>
